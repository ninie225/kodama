{% extends 'base.html.twig' %}
{% block title %}Kodama's Kitchen{% endblock %}

{% block stylesheets %}
    {{ parent() }}
    <link rel="stylesheet" href="{{ asset('styles/accueil.css') }}">
{% endblock %}

{% block body %}
    {# Section 1  #}
    <div class="accueil1 d-flex flex-column">
        {% include 'navbar.html.twig' %}
        <div class="flex-grow-1 d-flex flex-column justify-content-center align-items-center text-center text-white px-3">
            <h1 class="display-3 display-md-3">BIENVENUE CHEZ <br>KODAMA'S KITCHEN</h1>
            <p class="h5 typewriter my-3">Un voyage culinaire magique inspiré des mondes de Ghibli</p>
            <a href="{{ path('app_carte') }}" class="btn btn-light rounded-2 py-2 px-4 mt-4">Voir notre carte</a>
        </div>
    </div>

    {# Section 2 avec card Miyazaki + effet) #}
    <div class="accueil2">
        <h3 class="display-md-3 fw-bold">QUI EST LE CHEF MIYAZAKI ?</h3>

        <div class="card rounded-5 overflow-hidden content-card">
            <div class="row g-0">
                <div class="col-md-4">
                    <img src="{{ asset('images/uploads/accueil/miyazakiCard.png') }}" class="w-100 h-100" alt="Photo de Miyazaki">
                </div>
                <div class="col-md-8">
                    <div class="card-body p-4 d-flex align-items-center h-100">
                        <div class="w-100">
                            <p class="card-text">
                                Pour le chef Miyazaki, cuisiner, c'est raconter une histoire. Chaque recette est pensée comme un film, où textures et arômes évoquent des souvenirs, des émotions et des voyages imaginaires au cœur des univers du Studio Ghibli.
                            </p>
                            <h5 class="card-title mb-0 fw-bold">Hayao Miyazaki</h5>
                            <p class="card-text mt-0"><small>Chef cuisinier</small></p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    {# Sections 3 à 9  #}
    {% set sections = [
        {
            class: 'accueil3',
            year: '1985',
            subtitle: "Kodama's Kitchen est fondé.",
            text: "Hayao Miyazaki et Isao Takahata fondent officiellement le Studio Ghibli à Tokyo.",
            img: 'images/uploads/accueil/accueil3-Miyazaki.jpg',
            alt: 'Photo de Miyazaki et Takahata'
        },
        {
            class: 'accueil4',
            year: '1986',
            subtitle: "Ouverture du premier restaurant : le Château dans le ciel",
            text: "La première sortie officielle de Ghibli a donné le ton pour des décennies de plats imaginatifs.",
            img: 'images/uploads/accueil/accueil4-castle.jpg',
            alt: 'Photo du Château dans le ciel'
        },
        {
            class: 'accueil5',
            year: '1988',
            subtitle: "Sortie de Mon voisin Totoro",
            text: "Totoro est devenu un icône culturel et la mascotte du restaurant.",
            img: 'images/uploads/accueil/accueil5-totoro.jpg',
            alt: 'Photo de Totoro'
        },
        {
            class: 'accueil6',
            year: '2001',
            subtitle: "Ouverture de Kodama's Kitchen",
            text: "Le restaurant Ghibli le plus iconique avec ses 4 étoiles Michelin.",
            img: 'images/uploads/accueil/accueil6-restaurant.jpg',
            alt: 'Photo du restaurant'
        },
        {
            class: 'accueil7',
            year: '2004',
            subtitle: "Le château dans le ciel sort",
            text: "Un chef-d'œuvre de fantasy steampunk qui a consolidé la renommée internationale de Ghibli.",
            img: 'images/uploads/accueil/accueil7-castle.jpg',
            alt: 'Photo du Château dans le ciel'
        },
        {
            class: 'accueil8',
            year: '2008',
            subtitle: "Ponyo éclabousse la scène",
            text: "Inspiré de la petite sirène, ce restaurant a charmé les convives avec ses beaux plats.",
            img: 'images/uploads/accueil/accueil8-ponyo.webp',
            alt: 'Photo de Ponyo'
        },
        {
            class: 'accueil9',
            year: '2020',
            subtitle: "Les restaurants Ghibli dans le monde entier",
            text: "La franchise Studio Ghibli est disponible dans plusieurs pays.",
            img: 'images/uploads/accueil/accueil9-studio.jpg',
            alt: 'Photo du studio Ghibli'
        }
    ] %}

    {% for s in sections %}
        <div class="{{ s.class }} parallax d-flex align-items-center">
            <div class="container">
                <div class="row justify-content-center">
                    <div class="col-md-5 d-flex flex-column p-5 text-white">
                        <h2 class="display-md-2 fw-bold shadow-text">{{ s.year }}</h2>
                        <p class="fw-bold text-uppercase shadow-text" style="color: #87CEFA;">{{ s.subtitle }}</p>
                        <p class="fw-bold shadow-text">{{ s.text }}</p>
                    </div>
                    <div class="col-md-7 p-5">
                        <img src="{{ asset(s.img) }}" class="img-fluid rounded-4 shadow" alt="{{ s.alt }}">
                    </div>
                </div>
            </div>
        </div>
    {% endfor %}

    {# JS  #}
    <script>
        (function () {
        function inViewport(el, threshold = 0.5) {
            if (!el) return false;
            const r = el.getBoundingClientRect();
            const area = r.width * r.height;
            if (area === 0) return false;
            const vh = window.innerHeight, vw = window.innerWidth;
            const cx = Math.max(0, Math.min(r.right, vw) - Math.max(r.left, 0));
            const cy = Math.max(0, Math.min(r.bottom, vh) - Math.max(r.top, 0));
            const visibleArea = cx * cy;
            return (visibleArea / area) >= threshold;
        }

        function initAccueil2Tilt() {
            const card  = document.querySelector(".accueil2 .card");
            const title = document.querySelector(".accueil2 h3");
            if (!card || !title) return;

            if (card.dataset.tiltInitialized === "1") return;
            card.dataset.tiltInitialized = "1";

            // Lancement de l’animation quand le titre est visible
            const observer = new IntersectionObserver((entries) => {
            entries.forEach(entry => {
                if (entry.isIntersecting) {
                card.classList.add("animate-card");
                observer.disconnect();
                }
            });
            }, { threshold: 0.5 });
            observer.observe(title);

            // À la fin de l’anim: libère transform et rends la 3D persistante
            card.addEventListener("animationend", () => {
            card.classList.remove("animate-card");
            card.classList.add("allow-3d");
            card.style.opacity = "1";
            card.style.transform = "translate(-50%, -50%) scale(1)";
            });
            
            let shine = card.querySelector(".shine");
            if (!shine) {
            shine = document.createElement("div");
            shine.className = "shine";
            card.appendChild(shine);
            }

            // Effet mouvement carte
            const maxRotation = 10;
            let ticking = false, lastEvent = null;

            function applyTilt(e) {
            const rect = card.getBoundingClientRect();
            const x = e.clientX - rect.left;
            const y = e.clientY - rect.top;
            const cx = rect.width / 2;
            const cy = rect.height / 2;

            const rotateY = ((x - cx) / cx) * maxRotation;
            const rotateX = ((cy - y) / cy) * maxRotation;

            card.style.transform = `translate(-50%, -50%) rotateX(${rotateX}deg) rotateY(${rotateY}deg) scale(1.05)`;

            const percentX = (x / rect.width) * 100;
            const percentY = (y / rect.height) * 100;
            shine.style.background =
                `radial-gradient(circle at ${percentX}% ${percentY}%, rgba(255,255,255,0.4), transparent 60%)`;

            ticking = false;
            }

            card.addEventListener("mousemove", (e) => {
            if (!card.classList.contains("allow-3d")) return;
            lastEvent = e;
            if (!ticking) {
                ticking = true;
                requestAnimationFrame(() => applyTilt(lastEvent));
            }
            });

            card.addEventListener("mouseleave", () => {
            if (!card.classList.contains("allow-3d")) return;
            card.style.transition = "transform 0.5s ease-out";
            card.style.transform = "translate(-50%, -50%) rotateX(0) rotateY(0) scale(1)";
            shine.style.background = "transparent";
            setTimeout(() => (card.style.transition = "transform 0.08s ease-out"), 500);
            });

            // Si navigation interne / bfcache / Turbo
            if (inViewport(title, 0.5)) {
            card.classList.add("animate-card");
            }
        }

        // Si avigation classique, bfcache, Turbo (Hotwire)
        ["DOMContentLoaded", "load", "pageshow"].forEach(evt => {
            window.addEventListener(evt, initAccueil2Tilt, { once: false });
        });
        document.addEventListener("turbo:load", initAccueil2Tilt);
        })();
    </script>

{% endblock %}
